# DTMF Generator

------------------------------------------------

## 1. DTMF overview

DTMF is the abbreviation of `Dual Tone Multi Frequency`.
DTMF is a signaling method which uses two sine waves which have different frequencies. DTMF signal can be generated by just summation of two sine waves.

DTMF was used in telephone dial pads. Each buttons are mapped into unique combination of two different frequencies(See the table below).  

**DTMF Keypad Layout**

|      |1209 Hz | 1336 Hz| 1477 Hz| 1633 Hz|
|----------|:------:|:------:|:------:|:------:|
|**697 Hz**|    1   |   2    |   3    |   A    |
|**770 Hz**|    4   |   5    |   6    |   B    |
|**852 Hz**|    7   |   8    |   9    |   C    |
|**941 Hz**|    *   |   0    |   #    |   D    |

DTMF generate 16 combinations of dual frequencies using 8 frequencies.
4 of them are low-frequencies(`697, 770, 852, 941`Hz), called as row  tones, and other 4 are high-frequencies(`1209, 1336, 1477, 1633`Hz),called as column tones.


### 1.1 Encoding the signal

If `key 1` is pressed, the signal generated by summing sine waves of `697 Hz` and `1209 Hz` Frequency. `Key 4` has sine waves of `770 Hz` and `1209 Hz` and so on...

When DTMF signal is generated, the signal should be compliant with a **timing rule** which is different with encoding and decoding devices.

**Mark and Space**

**Mark** indicates the existing time of each digit tones.

**Space** means the duration of silence between each digits(DTMF signals) in sequence of DTMF signal.

>The standard for most radio decoders, as well as most telephone equipment is 40/40. The decoders expect the Dtmf tones to exist for at least 40 milliseconds, with 40 milliseconds of silence in between each Dtmf digit.
>   **from** [Genave - mark&space](http://www.genave.com/dtmf-mark-space.htm)

`40 ms` of mark means each DTMF signal have to contain at least `40 ms` length of active signal.

Conversely `40 ms` of space means that each mark should be followed by silent signal(space) which has at least `40 ms` length.

![](http://www.genave.com/graphics/mark-space.gif)

### 1.2 Decoding the signal

To decode the DTMF signal, **Goertzel algorithm** is used.

------------------------------------------------

## 2. Code explanation

`dtmf_samples.m` function takes in charge of generating DTMF samples.
A key value is the only argument which has to be passed in.
Then `dtmf_samples` will generate DTMF signal including space area(silent signal).

### 2.1 parameters
Inside the function, there are 2 important parameters.

1. **sampling_rate**

  It is used when generating samples.

  ``` matlab
  dt = 1/sampling_rate;
  ```

2. **digits_per_seconds**

  It stands for the number of digits sent by DTMF signal. **Mark(tone) and space(silence) duration** are totally determined with this parameter.

  ``` matlab
  %% DTMF Mark & Space duration
  % http://www.genave.com/dtmf-mark-space.htm
  mark_duration = 1/digits_per_seconds/2;
  space_duration = 1/digits_per_seconds/2;
  ```

### 2.2 DTMF signal generation and playing

DTMF signal is generated by summation of 2 sine waves which have different frequencies.
And then samples for silent area is concatenated after it.

``` matlab
samples_marks = sin(2*pi*freq(1)*t_mark) + sin(2*pi*freq(2)*t_mark); % mark area
samples_space = zeros(size(t_space));       % space area
samples = [samples_marks samples_space];    % concatenate 2 area
```

As DTMF samples are generated without scaling, samples are played by `soundsc` function which has scaling functionality.
The altenative function is `sound` and pre-scaling step is required.

```matlab
% play the samples
soundsc(samples, sampling_rate);
```

### 2.3 Run code

**1. test program**

run `dtmf_samples_test.m`

It generate a DTMF signal for `0123456789ABCD*#` dial.


**2. gui program**

run `dtmf_gui.m`.

**3. DTMF GUI interface**

![gui1](https://github.com/jaejunlee0538/matlab_ws/blob/master/digital_signal_processing/DTMF/dtmf_gui1.png)

sampling_rate and digits_per_second parameters can be modulated in GUI.
(You have to press `Enter` after changing the values)

**DTMF signal of keypad 1(`697` Hz + `1209` Hz)**

![gui2](https://github.com/jaejunlee0538/matlab_ws/blob/master/digital_signal_processing/DTMF/dtmf_gui2.png)

##References

1. [17dtmf_v13.ppt](http://www.ti.com/ww/cn/uprogram/share/ppt/c5000/17dtmf_v13.ppt)

2. [Genave : Dtmf - Mark and Space Timing Explained](http://www.genave.com/dtmf-mark-space.htm)

3. [Online Tone Generator - A Free and Simple Way to Generate DTMF Dial Tones](http://onlinetonegenerator.com/dtmf.html)

4. [Wikipedia : Dual-tone multi-frequency signaling](http://en.wikipedia.org/wiki/Dual-tone_multi-frequency_signaling)
